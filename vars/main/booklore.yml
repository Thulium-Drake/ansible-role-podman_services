---
podman_networks_booklore:
  booklore:
    - 'booklore-backend'

podman_volumes_booklore:
  booklore:
    - 'booklore-data'
    - 'booklore-books'
    - 'booklore-db'

podman_service_containers_booklore:
  booklore:
    db:
      image: 'docker.io/library/mariadb:latest'
      env:
        MYSQL_ROOT_PASSWORD: "{{ booklore_db_password }}"
        MYSQL_DATABASE: 'booklore'
        MYSQL_USER: 'booklore'
        MYSQL_PASSWORD: "{{ booklore_db_password }}"
      volume:
        - "{{ service['name'] }}-db:/var/lib/mysql:Z"
      network:
        - 'booklore-backend.network'
      healthcheck: 'mariadb-admin ping -h localhost -u${MYSQL_USER} -p${MYSQL_PASSWORD}'
      healthcheck_interval: '5s'
      healthcheck_retries: 10
      healthcheck_timeout: '3s'
    booklore:
      image: "docker.io/booklore/booklore:{{ booklore_version }}"
      labels:
        traefik.enable: true
        traefik.http.routers.booklore.rule: "Host(`{{ booklore_app_name }}.{{ traefik_domain }}`)"
        traefik.http.routers.booklore.tls: "true"
        traefik.http.services.booklore.loadbalancer.server.port: '6060'
      env:
        USER_ID: "{{ booklore_container_uid }}"
        GROUP_ID: "{{ booklore_container_gid }}"
        TZ: "{{ booklore_timezone }}"
        DATABASE_URL: 'jdbc:mariadb://booklore-db:3306/booklore'
        DATABASE_USER: 'booklore'
        DATABASE_PASSWORD: "{{ booklore_db_password }}"
      network:
        - 'traefik-backend.network'
        - 'booklore-backend.network'
      volume:
        - '{{ service["name"] }}-data:/app/data:Z'
        - '{{ service["name"] }}-books:/books:Z'
        - "{{ booklore_import_folder }}:/bookdrop"
