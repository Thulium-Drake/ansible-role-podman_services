---
podman_volumes_homeassistant:
  homeassistant:
    - 'homeassistant'
    - 'homeassistant-mqtt_config'
    - 'homeassistant-mqtt_data'
    - 'homeassistant-mqtt_log'

podman_networks_homeassistant:
  homeassistant:
    - 'homeassistant-backend'

podman_service_containers_homeassistant:
  homeassistant:
    homeassistant:
      image: "ghcr.io/home-assistant/home-assistant:{{ homeassistant_version }}"
      labels:
        traefik.enable: true
        traefik.http.routers.homeassistant.rule: "Host(`{{ homeassistant_app_name }}.{{ traefik_domain }}`)"
        traefik.http.routers.homeassistant.tls: "true"
        traefik.http.services.homeassistant.loadbalancer.server.port: '6767'
      ports: "{{ homeassistant_additional_ports | default([]) }}"
      volume:
        - "{{ service['name'] }}:/config:Z"
      network:
        - 'homeassistant-backend.network'
        - 'traefik-backend.network'
    mqtt:
      image: 'docker.io/library/eclipse-mosquitto:latest'
      ports: "{{ homeassistant_mqtt_port }}:1883"
      volume:
        - 'homeassistant-mqtt_config:/mosquitto/config:Z'
        - 'homeassistant-mqtt_data:/mosquitto/data:Z'
        - 'homeassistant-mqtt_log:/mosquitto/log:Z'
      network:
        - 'homeassistant-backend.network'
