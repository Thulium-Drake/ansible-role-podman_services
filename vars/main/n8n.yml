---
podman_volumes_n8n:
  n8n:
    - 'n8n-data'

podman_service_containers_n8n:
  n8n:
    n8n:
      # N8N + Heavy Python dependencies
      image: "{{ n8n_image_uri }}"
      privileged: true
      dns: "{{ podman_dns }}"
      ports:
        - '{{ n8n_port }}:5678'
      env:
        N8N_HOST: "{{ n8n_webhook_url }}"
        N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS: true
        WEBHOOK_URL: "{{ n8n_webhook_url }}"
        NODE_ENV: 'production'
        GENERIC_TIMEZONE: "{{ n8n_timezone }}"
        DB_TYPE: "{{ n8n_database_type }}"
        DB_POSTGRESDB_HOST: "{{ n8n_database_host | default(omit) }}"
        DB_POSTGRESDB_PORT: "{{ n8n_database_port | default(omit) }}"
        DB_POSTGRESDB_DATABASE: "{{ n8n_database_name | default(omit) }}"
        DB_POSTGRESDB_USER: "{{ n8n_database_user | default(omit) }}"
        DB_POSTGRESDB_PASSWORD: "{{ n8n_database_password | default(omit) }}"
      volume:
        - '/run/podman/podman.sock:/run/podman/podman.sock:Z'
        - "{{ service['name'] }}-data:/home/node/.n8n:Z"
