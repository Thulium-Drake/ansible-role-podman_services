---
podman_volumes_vikunja:
  vikunja:
    - 'vikunja-files'
    - 'vikunja-db'

podman_service_containers_vikunja:
  vikunja:
    vikunja:
      image: "docker.io/vikunja/vikunja:{{ vikunja_version }}"
      labels:
        traefik.enable: true
        traefik.http.routers.vikunja.rule: "Host(`{{ vikunja_app_name }}.{{ traefik_domain }}`)"
        traefik.http.routers.vikunja.tls: "true"
        traefik.http.services.vikunja.loadbalancer.server.port: '3456'
      env:
        VIKUNJA_SERVICE_JWTSECRET: "{{ vikunja_jwt_secret }}"
        VIKUNJA_SERVICE_PUBLICURL: "{{ vikunja_public_url }}"
        VIKUNJA_DATABASE_PATH: "{{ vikunja_database_path }}"
        VIKUNJA_MAILER_ENABLED: "{{ vikunja_mailer_enabled }}"
        VIKUNJA_MAILER_HOST: "{{ vikunja_mailer_host }}"
        VIKUNJA_MAILER_PORT: "{{ vikunja_mailer_port }}"
        VIKUNJA_MAILER_AUTHTYPE: "{{ vikunja_mailer_authtype }}"
        VIKUNJA_MAILER_USERNAME: "{{ vikunja_mailer_username | default(omit, true) }}"
        VIKUNJA_MAILER_PASSWORD: "{{ vikunja_mailer_password | default(omit, true) }}"
        VIKUNJA_MAILER_SKIPTLSVERIFY: "{{ vikunja_mailer_insecure }}"
        VIKUNJA_MAILER_FROMEMAIL: "{{ vikunja_mailer_from_address }}"
      network:
        - 'traefik-backend.network'
      volume:
        - '{{ service["name"] }}-files:/app/vikunja/files:Z'
        - '{{ service["name"] }}-db:/db:Z'
